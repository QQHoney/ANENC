<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‰é’®æµ‹è¯•</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .test-box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .log { background: #333; color: #0f0; padding: 10px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h2>ğŸ”§ æŒ‰é’®åŠŸèƒ½æµ‹è¯•</h2>

    <div class="test-box">
        <h3>æµ‹è¯•1ï¼šæ£€æŸ¥æŒ‰é’®æ˜¯å¦å­˜åœ¨</h3>
        <button onclick="checkButtons()">æ£€æŸ¥è¿”å›æŒ‰é’®</button>
        <div id="result1" class="log"></div>
    </div>

    <div class="test-box">
        <h3>æµ‹è¯•2ï¼šæ‰‹åŠ¨è§¦å‘è¿”å›</h3>
        <button onclick="testBack()">æ¨¡æ‹Ÿç‚¹å‡»è¿”å›æŒ‰é’®</button>
        <div id="result2" class="log"></div>
    </div>

    <div class="test-box">
        <h3>æµ‹è¯•3ï¼šé¡µé¢åˆ‡æ¢æµ‹è¯•</h3>
        <button onclick="testSwitch()">æµ‹è¯•é¡µé¢åˆ‡æ¢</button>
        <div id="result3" class="log"></div>
    </div>

    <div class="test-box">
        <h3>æµ‹è¯•4ï¼šç›´æ¥ä¿®å¤</h3>
        <button onclick="applyFix()">åº”ç”¨ä¸€é”®ä¿®å¤</button>
        <div id="result4" class="log"></div>
    </div>

    <script>
        function log(id, msg) {
            const el = document.getElementById(id);
            el.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            el.scrollTop = el.scrollHeight;
        }

        function checkButtons() {
            const btns = document.querySelectorAll('.back-btn');
            log('result1', `æ‰¾åˆ° ${btns.length} ä¸ªè¿”å›æŒ‰é’®`);

            btns.forEach((btn, i) => {
                log('result1', `æŒ‰é’® ${i+1}: data-back="${btn.dataset.back}"`);
                btn.addEventListener('click', () => {
                    log('result1', `æŒ‰é’® ${i+1} è¢«ç‚¹å‡»`);
                });
            });
        }

        function testBack() {
            log('result2', 'æ¨¡æ‹Ÿè¿”å›æŒ‰é’®ç‚¹å‡»...');

            if (typeof App === 'undefined') {
                log('result2', 'âŒ Appå¯¹è±¡ä¸å­˜åœ¨');
                return;
            }

            if (typeof App.switchToPage !== 'function') {
                log('result2', 'âŒ switchToPageå‡½æ•°ä¸å­˜åœ¨');
                return;
            }

            try {
                App.switchToPage('main');
                log('result2', 'âœ… switchToPage("main") è°ƒç”¨æˆåŠŸ');
            } catch (e) {
                log('result2', `âŒ é”™è¯¯: ${e.message}`);
            }
        }

        function testSwitch() {
            log('result3', 'æµ‹è¯•å„ç§é¡µé¢åˆ‡æ¢...');

            const tests = [
                { name: 'Utils.switchPage("main-page")', fn: () => Utils.switchPage('main-page') },
                { name: 'App.switchToPage("main")', fn: () => App.switchToPage('main') },
                { name: 'App.switchToPage("friend")', fn: () => App.switchToPage('friend') }
            ];

            tests.forEach(test => {
                try {
                    test.fn();
                    log('result3', `âœ… ${test.name} - æˆåŠŸ`);
                } catch (e) {
                    log('result3', `âŒ ${test.name} - ${e.message}`);
                }
            });
        }

        function applyFix() {
            log('result4', 'åº”ç”¨ä¿®å¤...');

            // ä¿®å¤1ï¼šç¡®ä¿switchToPageæœ‰mainæ˜ å°„
            if (App && App.switchToPage) {
                const original = App.switchToPage;
                App.switchToPage = function(page) {
                    console.log('ä¿®å¤åçš„switchToPage:', page);
                    return original.call(this, page);
                };
                log('result4', 'âœ… å¢å¼ºswitchToPage');
            }

            // ä¿®å¤2ï¼šå¢å¼ºUtils.switchPage
            if (Utils && Utils.switchPage) {
                const original = Utils.switchPage;
                Utils.switchPage = function(pageId) {
                    console.log('ä¿®å¤åçš„Utils.switchPage:', pageId);
                    const pages = document.querySelectorAll('.page');
                    pages.forEach(p => {
                        p.classList.remove('active');
                        p.style.display = 'none';
                    });
                    const target = document.getElementById(pageId);
                    if (target) {
                        target.classList.add('active');
                        target.style.display = 'flex';
                        console.log('âœ… é¡µé¢åˆ‡æ¢æˆåŠŸ:', pageId);
                    } else {
                        console.error('âŒ é¡µé¢æœªæ‰¾åˆ°:', pageId);
                    }
                };
                log('result4', 'âœ… å¢å¼ºUtils.switchPage');
            }

            log('result4', 'ä¿®å¤å®Œæˆï¼Œè¯·æµ‹è¯•è¿”å›æŒ‰é’®');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            console.log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            if (typeof App === 'undefined') {
                alert('âŒ Appå¯¹è±¡æœªåŠ è½½ï¼Œè¯·å…ˆæ‰“å¼€åŸç‰ˆindex.html');
            }
        });
    </script>
</body>
</html>
