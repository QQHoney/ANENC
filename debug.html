<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰èƒ½ç‰©æµå†œåœº - è°ƒè¯•ç‰ˆ</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/animations.css">
    <style>
        /* è°ƒè¯•é¢æ¿æ ·å¼ */
        #debug-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            padding: 10px;
            overflow-y: auto;
            z-index: 9999;
            border-left: 2px solid #0f0;
        }

        #debug-panel h3 {
            color: #fff;
            margin: 0 0 10px 0;
            font-size: 14px;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
        }

        #debug-panel div {
            margin: 2px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        #debug-controls {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 300px;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            z-index: 9998;
            border-top: 1px solid #0f0;
        }

        #debug-controls button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 5px 10px;
            margin: 2px;
            cursor: pointer;
            font-weight: bold;
            font-size: 11px;
        }

        #debug-controls button:hover {
            background: #fff;
        }

        /* è®©ä¸»å†…å®¹é¿å¼€è°ƒè¯•é¢æ¿ */
        #app {
            margin-right: 300px;
        }

        /* é”™è¯¯é«˜äº® */
        .error-message {
            color: #ff0000 !important;
            font-weight: bold;
        }

        .success-message {
            color: #00ff00 !important;
        }

        .warning-message {
            color: #ffff00 !important;
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•é¢æ¿ -->
    <div id="debug-panel">
        <h3>ğŸ› è°ƒè¯•æ—¥å¿—</h3>
        <div id="debug-log">ç­‰å¾…åˆå§‹åŒ–...</div>
    </div>

    <div id="debug-controls">
        <h4 style="color: #fff; margin: 0 0 5px 0;">è°ƒè¯•æ§åˆ¶</h4>
        <button onclick="clearDebugLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button onclick="testLocalStorage()">æµ‹è¯•å­˜å‚¨</button>
        <button onclick="showUserInfo()">æ˜¾ç¤ºç”¨æˆ·</button>
        <button onclick="clearAllData()">æ¸…é™¤æ•°æ®</button>
        <button onclick="toggleDebugPanel()">éšè—é¢æ¿</button>
    </div>

    <!-- åŸå§‹HTMLå†…å®¹ -->
    <div id="app">
        <!-- åŠ è½½é¡µé¢ -->
        <div id="loading-screen" class="page active">
            <div class="loading-content">
                <div class="logo-container">
                    <svg class="logo" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="100" cy="100" r="90" fill="#FF6B00"/>
                        <rect x="50" y="70" width="100" height="60" rx="10" fill="#fff"/>
                        <rect x="60" y="85" width="30" height="30" rx="5" fill="#FFB366"/>
                        <rect x="100" y="85" width="40" height="30" rx="5" fill="#FFB366"/>
                        <circle cx="70" cy="140" r="12" fill="#333"/>
                        <circle cx="130" cy="140" r="12" fill="#333"/>
                    </svg>
                </div>
                <h1>å®‰èƒ½ç‰©æµå†œåœº</h1>
                <div class="loading-bar">
                    <div class="loading-progress"></div>
                </div>
                <p class="loading-text">æ­£åœ¨åŠ è½½...</p>
            </div>
        </div>

        <!-- ç™»å½•é¡µé¢ -->
        <div id="login-page" class="page">
            <div class="login-container">
                <div class="login-header">
                    <svg class="login-logo" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="100" cy="100" r="90" fill="#FF6B00"/>
                        <rect x="50" y="70" width="100" height="60" rx="10" fill="#fff"/>
                        <rect x="60" y="85" width="30" height="30" rx="5" fill="#FFB366"/>
                        <rect x="100" y="85" width="40" height="30" rx="5" fill="#FFB366"/>
                        <circle cx="70" cy="140" r="12" fill="#333"/>
                        <circle cx="130" cy="140" r="12" fill="#333"/>
                    </svg>
                    <h1>å®‰èƒ½ç‰©æµå†œåœº</h1>
                    <p class="tagline">ç»è¥ä½ çš„ç‰©æµç«™åœºï¼Œæˆä¸ºç‰©æµå¤§äº¨ï¼</p>
                </div>
                <div class="login-form">
                    <div class="form-group">
                        <label>æ˜µç§°</label>
                        <input type="text" id="nickname-input" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°" maxlength="12">
                    </div>
                    <button id="login-btn" class="btn-primary">å¼€å§‹æ¸¸æˆ</button>
                </div>
                <div class="login-features">
                    <div class="feature-item">
                        <span class="feature-icon">ğŸ“¦</span>
                        <span>å¤„ç†è´§ç‰©èµšé‡‘å¸</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ğŸƒ</span>
                        <span>æˆªèƒ¡å¥½å‹è´§ç‰©</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ğŸ’¬</span>
                        <span>åˆ†æ‹¨èŠå¤©äº’åŠ¨</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ³¨å†Œé¡µé¢ï¼ˆé€‰æ‹©åˆ†æ‹¨ï¼‰ -->
        <div id="register-page" class="page">
            <div class="register-container">
                <div class="register-header">
                    <h2>é€‰æ‹©ä½ çš„åˆ†æ‹¨</h2>
                    <p>æ³¨å†Œåä¸å¯æ›´æ¢ï¼Œè¯·è°¨æ…é€‰æ‹©</p>
                </div>
                <div class="branch-grid" id="branch-list">
                    <!-- åˆ†æ‹¨åˆ—è¡¨åŠ¨æ€æ¸²æŸ“ -->
                </div>
                <button id="confirm-branch-btn" class="btn-primary" disabled>ç¡®è®¤é€‰æ‹©</button>
            </div>
        </div>

        <!-- ä¸»æ¸¸æˆé¡µé¢ -->
        <div id="main-page" class="page">
            <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯æ  -->
            <header class="user-bar">
                <div class="user-left" id="go-profile">
                    <img class="avatar" id="user-avatar" src="assets/default-avatar.svg" alt="å¤´åƒ">
                    <div class="user-info">
                        <span class="nickname" id="user-nickname">ç©å®¶</span>
                        <div class="level-bar">
                            <span class="level" id="user-level">Lv.1</span>
                            <div class="exp-bar">
                                <div class="exp-fill" id="exp-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="user-right">
                    <div class="currency">
                        <img src="assets/icons/coin.svg" alt="é‡‘å¸">
                        <span id="user-coins">0</span>
                    </div>
                    <div class="currency">
                        <img src="assets/icons/diamond.svg" alt="é’»çŸ³">
                        <span id="user-diamonds">0</span>
                    </div>
                </div>
            </header>

            <!-- åˆ†æ‹¨ä¿¡æ¯ -->
            <div class="branch-bar">
                <img src="assets/icons/location.svg" alt="ä½ç½®">
                <span id="branch-name">æœªçŸ¥åˆ†æ‹¨</span>
            </div>

            <!-- ç«™åœºåŒºåŸŸ -->
            <div class="station-area">
                <div class="station-title">
                    <span class="title-text">æˆ‘çš„ç«™åœº</span>
                    <span class="slot-info" id="slot-info">è´§ä½ 0/6</span>
                </div>
                <div class="cargo-grid" id="cargo-grid">
                    <!-- è´§ä½åŠ¨æ€æ¸²æŸ“ -->
                </div>
            </div>

            <!-- å¿«æ·æ“ä½œ -->
            <div class="quick-actions">
                <button class="action-btn" id="harvest-all-btn">
                    <img src="assets/icons/harvest.svg" alt="æ”¶å–">
                    <span>ä¸€é”®æ”¶å–</span>
                </button>
                <button class="action-btn" id="visit-friend-btn">
                    <img src="assets/icons/visit.svg" alt="æ‹œè®¿">
                    <span>æ‹œè®¿å¥½å‹</span>
                </button>
                <button class="action-btn" id="ranking-btn">
                    <img src="assets/icons/ranking.svg" alt="æ’è¡Œ">
                    <span>æ’è¡Œæ¦œ</span>
                </button>
            </div>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <nav class="tab-bar">
                <div class="tab-item active" data-page="station">
                    <img src="assets/icons/station.svg" alt="ç«™åœº">
                    <span>æˆ‘çš„ç«™åœº</span>
                </div>
                <div class="tab-item" data-page="friend">
                    <img src="assets/icons/friend.svg" alt="å¥½å‹">
                    <span>å¥½å‹</span>
                </div>
                <div class="tab-item" data-page="chat">
                    <img src="assets/icons/chat.svg" alt="èŠå¤©">
                    <span>èŠå¤©</span>
                </div>
                <div class="tab-item" data-page="shop">
                    <img src="assets/icons/shop.svg" alt="å•†åŸ">
                    <span>å•†åŸ</span>
                </div>
                <div class="tab-item" data-page="profile">
                    <img src="assets/icons/profile.svg" alt="æˆ‘çš„">
                    <span>æˆ‘çš„</span>
                </div>
            </nav>
        </div>

        <!-- å¥½å‹é¡µé¢ -->
        <div id="friend-page" class="page sub-page">
            <header class="page-header">
                <button class="back-btn" data-back="main">â†</button>
                <h2>å¥½å‹åˆ—è¡¨</h2>
                <button class="header-btn" id="add-friend-btn">+æ·»åŠ </button>
            </header>
            <div class="friend-tabs">
                <div class="friend-tab active" data-tab="friends">å¥½å‹</div>
                <div class="friend-tab" data-tab="branch">åˆ†æ‹¨æˆå‘˜</div>
            </div>
            <div class="friend-list" id="friend-list">
                <!-- å¥½å‹åˆ—è¡¨åŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>

        <!-- èŠå¤©é¡µé¢ -->
        <div id="chat-page" class="page sub-page">
            <header class="page-header">
                <button class="back-btn" data-back="main">â†</button>
                <h2>èŠå¤©</h2>
            </header>
            <div class="chat-tabs">
                <div class="chat-tab active" data-type="branch">
                    <span>åˆ†æ‹¨é¢‘é“</span>
                    <span class="badge" id="branch-unread"></span>
                </div>
                <div class="chat-tab" data-type="world">
                    <span>ä¸–ç•Œå¹¿æ’­</span>
                    <span class="badge" id="world-unread"></span>
                </div>
            </div>
            <div class="chat-info-bar" id="chat-info-bar">
                <img src="assets/icons/users.svg" alt="åœ¨çº¿">
                <span id="chat-info-text">åˆ†æ‹¨é¢‘é“ Â· åœ¨çº¿ 0 äºº</span>
            </div>
            <div class="message-list" id="message-list">
                <!-- æ¶ˆæ¯åˆ—è¡¨åŠ¨æ€æ¸²æŸ“ -->
            </div>
            <div class="input-area">
                <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." maxlength="200">
                <button class="send-btn" id="send-btn">å‘é€</button>
            </div>
        </div>

        <!-- å•†åŸé¡µé¢ -->
        <div id="shop-page" class="page sub-page">
            <header class="page-header">
                <button class="back-btn" data-back="main">â†</button>
                <h2>å•†åŸ</h2>
            </header>
            <div class="currency-bar shop-currency">
                <div class="currency-item">
                    <img src="assets/icons/coin.svg" alt="é‡‘å¸">
                    <span id="shop-coins">0</span>
                </div>
                <div class="currency-item">
                    <img src="assets/icons/diamond.svg" alt="é’»çŸ³">
                    <span id="shop-diamonds">0</span>
                </div>
            </div>
            <div class="shop-tabs">
                <div class="shop-tab active" data-category="props">é“å…·</div>
                <div class="shop-tab" data-category="special">ç‰¹æ®Š</div>
            </div>
            <div class="shop-list" id="shop-list">
                <!-- å•†å“åˆ—è¡¨åŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>

        <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
        <div id="profile-page" class="page sub-page">
            <header class="page-header">
                <button class="back-btn" data-back="main">â†</button>
                <h2>ä¸ªäººä¸­å¿ƒ</h2>
            </header>
            <div class="profile-content">
                <div class="profile-card">
                    <img class="profile-avatar" id="profile-avatar" src="assets/default-avatar.svg" alt="å¤´åƒ">
                    <div class="profile-info">
                        <h3 id="profile-nickname">ç©å®¶</h3>
                        <p id="profile-branch">åˆ†æ‹¨</p>
                        <div class="profile-stats">
                            <div class="stat">
                                <span class="stat-value" id="profile-level">1</span>
                                <span class="stat-label">ç­‰çº§</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="profile-coins">0</span>
                                <span class="stat-label">é‡‘å¸</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="profile-diamonds">0</span>
                                <span class="stat-label">é’»çŸ³</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <h4>æˆ‘çš„é“å…·</h4>
                    <div class="items-grid" id="items-grid">
                        <!-- é“å…·åˆ—è¡¨åŠ¨æ€æ¸²æŸ“ -->
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="btn-secondary" id="logout-btn">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- æ’è¡Œæ¦œé¡µé¢ -->
        <div id="ranking-page" class="page sub-page">
            <header class="page-header">
                <button class="back-btn" data-back="main">â†</button>
                <h2>æ’è¡Œæ¦œ</h2>
            </header>
            <div class="ranking-tabs">
                <div class="ranking-tab active" data-type="coins">è´¢å¯Œæ¦œ</div>
                <div class="ranking-tab" data-type="level">ç­‰çº§æ¦œ</div>
                <div class="ranking-tab" data-type="steal">æˆªèƒ¡æ¦œ</div>
            </div>
            <div class="ranking-scope">
                <button class="scope-btn active" data-scope="all">å…¨æœ</button>
                <button class="scope-btn" data-scope="branch">åˆ†æ‹¨</button>
            </div>
            <div class="ranking-list" id="ranking-list">
                <!-- æ’è¡Œæ¦œåŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>
    </div>

    <!-- è´§ç‰©é€‰æ‹©å¼¹çª— -->
    <div id="cargo-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>é€‰æ‹©è´§ç‰©ç±»å‹</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="cargo-list" id="cargo-type-list">
                <!-- è´§ç‰©ç±»å‹åŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>
    </div>

    <!-- æ“ä½œèœå•å¼¹çª— -->
    <div id="action-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="action-menu" id="action-menu">
            <!-- æ“ä½œèœå•åŠ¨æ€æ¸²æŸ“ -->
        </div>
    </div>

    <!-- è´­ä¹°å¼¹çª— -->
    <div id="buy-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="buy-item-name">è´­ä¹°é“å…·</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="buy-body">
                <div class="buy-preview">
                    <img id="buy-item-icon" src="" alt="é“å…·">
                    <p id="buy-item-desc"></p>
                </div>
                <div class="quantity-selector">
                    <button class="qty-btn" id="qty-decrease">-</button>
                    <input type="number" id="qty-input" value="1" min="1" max="99">
                    <button class="qty-btn" id="qty-increase">+</button>
                </div>
                <div class="total-price">
                    <span>æ€»ä»·ï¼š</span>
                    <img id="buy-currency-icon" src="" alt="è´§å¸">
                    <span id="total-price-value">0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="confirm-buy-btn">ç¡®è®¤è´­ä¹°</button>
            </div>
        </div>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast" class="toast"></div>

    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app-debug.js"></script>

    <script>
        // è°ƒè¯•å·¥å…·å‡½æ•°
        function addDebugLog(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            if (!logDiv) return;

            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');

            if (type === 'error') {
                div.className = 'error-message';
                div.textContent = `[${timestamp}] âŒ ${message}`;
            } else if (type === 'success') {
                div.className = 'success-message';
                div.textContent = `[${timestamp}] âœ… ${message}`;
            } else if (type === 'warning') {
                div.className = 'warning-message';
                div.textContent = `[${timestamp}] âš ï¸ ${message}`;
            } else {
                div.textContent = `[${timestamp}] â„¹ï¸ ${message}`;
            }

            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearDebugLog() {
            const logDiv = document.getElementById('debug-log');
            if (logDiv) {
                logDiv.innerHTML = 'æ—¥å¿—å·²æ¸…ç©º';
            }
        }

        function testLocalStorage() {
            try {
                localStorage.setItem('test', 'test');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                addDebugLog(`localStorage æµ‹è¯•é€šè¿‡: ${value}`, 'success');
            } catch (e) {
                addDebugLog(`localStorage é”™è¯¯: ${e.message}`, 'error');
            }
        }

        function showUserInfo() {
            const userInfo = Storage.getUserInfo();
            if (userInfo) {
                addDebugLog(`å½“å‰ç”¨æˆ·: ${JSON.stringify(userInfo, null, 2)}`, 'success');
            } else {
                addDebugLog('å½“å‰æ— ç™»å½•ç”¨æˆ·', 'warning');
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰æ¸¸æˆè¿›åº¦ï¼')) {
                Storage.clearAll();
                addDebugLog('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤', 'success');
                location.reload();
            }
        }

        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            const controls = document.getElementById('debug-controls');
            const app = document.getElementById('app');

            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                controls.style.display = 'block';
                app.style.marginRight = '300px';
            } else {
                panel.style.display = 'none';
                controls.style.display = 'none';
                app.style.marginRight = '0';
            }
        }

        // é‡å†™Appçš„debugLogæ–¹æ³•ï¼ŒåŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œè°ƒè¯•é¢æ¿
        const originalDebugLog = App.debugLog;
        App.debugLog = function(message, type = 'info') {
            originalDebugLog.call(this, message, type);
            addDebugLog(message, type);
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„é¢å¤–è°ƒè¯•ä¿¡æ¯
        window.addEventListener('load', () => {
            addDebugLog('é¡µé¢åŠ è½½å®Œæˆ', 'success');
            addDebugLog(`æµè§ˆå™¨: ${navigator.userAgent}`, 'info');
            addDebugLog(`å±å¹•åˆ†è¾¨ç‡: ${screen.width}x${screen.height}`, 'info');
            addDebugLog(`å¯ç”¨å­˜å‚¨ç©ºé—´: ${navigator.storage?.estimate ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`, 'info');
        });
    </script>
</body>
</html>
