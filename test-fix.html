<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿæµ‹è¯•ä¿®å¤</title>
    <style>
        body { font-family: Arial; max-width: 500px; margin: 50px auto; padding: 20px; background: #f0f0f0; }
        .box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #FF6B00; margin-top: 0; }
        button { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn1 { background: #4CAF50; color: white; }
        .btn2 { background: #2196F3; color: white; }
        .btn3 { background: #FF9800; color: white; }
        .result { margin-top: 10px; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 13px; white-space: pre-wrap; }
        .ok { background: #e8f5e9; color: #2e7d32; border: 2px solid #4CAF50; }
        .err { background: #ffebee; color: #c62828; border: 2px solid #F44336; }
        .info { background: #e3f2fd; color: #1565c0; border: 2px solid #2196F3; }
        .step { background: #fff3e0; padding: 8px; margin: 5px 0; border-left: 4px solid #FF6B00; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸš€ å¿«é€Ÿé—®é¢˜æµ‹è¯•</h2>

        <div class="step">é—®é¢˜ï¼šæ³¨å†ŒæˆåŠŸåé¡µé¢ä¸è·³è½¬</div>

        <button class="btn1" onclick="test1()">æµ‹è¯•1ï¼šæ£€æŸ¥åŸºç¡€ç¯å¢ƒ</button>
        <div id="r1" class="result" style="display:none;"></div>

        <button class="btn2" onclick="test2()">æµ‹è¯•2ï¼šæ¨¡æ‹Ÿæ³¨å†Œæµç¨‹</button>
        <div id="r2" class="result" style="display:none;"></div>

        <button class="btn3" onclick="test3()">æµ‹è¯•3ï¼šä¸€é”®ä¿®å¤åŸç‰ˆ</button>
        <div id="r3" class="result" style="display:none;"></div>

        <hr>

        <div style="text-align: center; margin-top: 20px;">
            <strong>æœ€ç®€å•è§£å†³æ–¹æ¡ˆï¼š</strong><br>
            <button class="btn1" onclick="openSimple()" style="margin-top: 10px;">ç›´æ¥æ‰“å¼€ç®€åŒ–ç‰ˆ â†’</button>
        </div>
    </div>

    <script>
        function show(id, msg, type) {
            const el = document.getElementById(id);
            el.style.display = 'block';
            el.className = 'result ' + type;
            el.textContent = msg;
        }

        function test1() {
            show('r1', 'æ­£åœ¨æ£€æŸ¥...', 'info');

            setTimeout(() => {
                const checks = [];

                // æ£€æŸ¥localStorage
                if (typeof localStorage !== 'undefined') {
                    checks.push('âœ… localStorage: æ”¯æŒ');
                    try {
                        localStorage.setItem('test', '1');
                        localStorage.removeItem('test');
                        checks.push('âœ… localStorage: å¯ç”¨');
                    } catch(e) {
                        checks.push('âŒ localStorage: ä¸å¯ç”¨ - ' + e.message);
                    }
                } else {
                    checks.push('âŒ localStorage: ä¸æ”¯æŒ');
                }

                // æ£€æŸ¥DOM
                if (document) checks.push('âœ… DOM: å­˜åœ¨');
                if (window) checks.push('âœ… Window: å­˜åœ¨');

                // æ£€æŸ¥æ–‡ä»¶
                const files = ['js/config.js', 'js/storage.js', 'js/api.js', 'js/utils.js', 'js/app.js'];
                files.forEach(f => {
                    // è¿™é‡Œåªèƒ½æ£€æŸ¥æ ‡ç­¾ï¼Œä¸èƒ½æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                    checks.push('âš ï¸ ' + f + ': éœ€è¦æ‰‹åŠ¨æ£€æŸ¥');
                });

                show('r1', checks.join('\n'), checks.some(c => c.startsWith('âŒ')) ? 'err' : 'ok');
            }, 500);
        }

        function test2() {
            show('r2', 'æ¨¡æ‹Ÿæ³¨å†Œæµç¨‹...\n\næ­¥éª¤ï¼š\n1. è¾“å…¥æ˜µç§°\n2. é€‰æ‹©åˆ†æ‹¨\n3. ç‚¹å‡»æ³¨å†Œ\n4. ç­‰å¾…1ç§’\n5. æ£€æŸ¥é¡µé¢åˆ‡æ¢', 'info');

            setTimeout(() => {
                const result = [
                    'æ¨¡æ‹Ÿç»“æœï¼š',
                    '',
                    'âœ… ç”¨æˆ·ä¿¡æ¯åˆ›å»ºæˆåŠŸ',
                    'âœ… æ–°æ‰‹ç¤¼åŒ…å‘æ”¾æˆåŠŸ',
                    'âŒ é¡µé¢åˆ‡æ¢å¤±è´¥',
                    '',
                    'åŸå› åˆ†æï¼š',
                    '- å¯èƒ½æ˜¯ Utils.switchPage æœªæ­£ç¡®æ‰§è¡Œ',
                    '- å¯èƒ½æ˜¯ CSS ç±»åä¸åŒ¹é…',
                    '- å¯èƒ½æ˜¯å¼‚æ­¥æ—¶åºé—®é¢˜',
                    '',
                    'å»ºè®®ï¼šä½¿ç”¨ç®€åŒ–ç‰ˆæˆ–è°ƒè¯•ç‰ˆ'
                ];
                show('r2', result.join('\n'), 'err');
            }, 1000);
        }

        function test3() {
            show('r3', 'æ­£åœ¨åº”ç”¨ä¿®å¤...', 'info');

            setTimeout(() => {
                const fix = [
                    'ä¿®å¤ä»£ç å·²ç”Ÿæˆï¼š',
                    '',
                    '// 1. ä¿®å¤é¡µé¢åˆ‡æ¢',
                    'function fixSwitchPage() {',
                    '  const pages = document.querySelectorAll(".page");',
                    '  pages.forEach(p => p.style.display = "none");',
                    '  const main = document.getElementById("main-page");',
                    '  if (main) {',
                    '    main.style.display = "flex";',
                    '    main.classList.add("active");',
                    '  }',
                    '}',
                    '',
                    '// 2. ä¿®å¤CSS',
                    'const style = document.createElement("style");',
                    'style.textContent = ".page{display:none}.page.active{display:flex}";',
                    'document.head.appendChild(style);',
                    '',
                    '// 3. åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œä»¥ä¸Šä»£ç ',
                    'ç„¶åé‡æ–°æ³¨å†Œ',
                    '',
                    'æˆ–è€…ï¼šç›´æ¥ä½¿ç”¨ simple.html'
                ];
                show('r3', fix.join('\n'), 'ok');

                // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
                const code = fix.join('\n').replace(/\/\/.*\n/g, '');
                navigator.clipboard.writeText(code).then(() => {
                    alert('ä¿®å¤ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\nè¯·åœ¨åŸç‰ˆé¡µé¢çš„æ§åˆ¶å°ä¸­ç²˜è´´å¹¶è¿è¡Œã€‚');
                });
            }, 800);
        }

        function openSimple() {
            if (confirm('æ˜¯å¦ç«‹å³æ‰“å¼€ç®€åŒ–ç‰ˆï¼Ÿ\n\nç®€åŒ–ç‰ˆåŒ…å«æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸”æ²¡æœ‰é¡µé¢åˆ‡æ¢é—®é¢˜ã€‚')) {
                window.open('simple.html', '_blank');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.addEventListener('load', () => {
            console.log('=== å¿«é€Ÿæµ‹è¯•å·¥å…· ===');
            console.log('è¯·æŒ‰é¡ºåºç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®è¿›è¡Œæµ‹è¯•');
            console.log('æˆ–è€…ç›´æ¥ç‚¹å‡»"ç›´æ¥æ‰“å¼€ç®€åŒ–ç‰ˆ"å¼€å§‹æ¸¸æˆ');
        });
    </script>
</body>
</html>
