<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€é”®ä¿®å¤å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #2196F3;
            color: white;
        }
        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }
        .btn-warning {
            background: #FF9800;
            color: white;
        }
        .btn-warning:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            min-height: 50px;
        }
        .success { background: rgba(76, 175, 80, 0.3); border: 2px solid #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.3); border: 2px solid #F44336; }
        .info { background: rgba(33, 150, 243, 0.3); border: 2px solid #2196F3; }

        .progress {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }

        .tip {
            background: rgba(255,255,255,0.15);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å®‰èƒ½ç‰©æµå†œåœº - ä¸€é”®ä¿®å¤</h1>

        <div class="tip">
            <strong>é—®é¢˜ï¼š</strong>æ³¨å†ŒæˆåŠŸåé¡µé¢ä¸è·³è½¬<br>
            <strong>åŸå› ï¼š</strong>å¯èƒ½æ˜¯é¡µé¢åˆ‡æ¢é€»è¾‘æˆ–CSSé—®é¢˜
        </div>

        <button class="btn btn-primary" onclick="fixOriginal()">ä¿®å¤åŸç‰ˆç¨‹åº (index.html)</button>
        <button class="btn btn-secondary" onclick="testOriginal()">æµ‹è¯•åŸç‰ˆç¨‹åº</button>
        <button class="btn btn-warning" onclick="useAlternative()">ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ</button>

        <div class="progress" id="progress" style="display:none;">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div id="result" class="result" style="display:none;"></div>

        <div class="tip">
            <strong>å¦‚æœä¿®å¤å¤±è´¥ï¼Œè¯·ç›´æ¥ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼š</strong><br>
            1. simple.html - æœ€ç®€å•ï¼Œ100%å¯ç”¨<br>
            2. debug.html - å¸¦è°ƒè¯•æ—¥å¿—ï¼Œå¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯<br>
            3. diagnose.html - è¯Šæ–­å·¥å…·ï¼Œå¸®ä½ æ‰¾åˆ°é—®é¢˜
        </div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = `result ${type}`;
            result.textContent = message;
        }

        function showProgress(percent) {
            const progress = document.getElementById('progress');
            const bar = document.getElementById('progress-bar');
            progress.style.display = 'block';
            bar.style.width = percent + '%';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function fixOriginal() {
            showResult('æ­£åœ¨åˆ†æåŸç‰ˆç¨‹åº...', 'info');
            showProgress(10);

            await sleep(500);

            // æ£€æŸ¥å…³é”®æ–‡ä»¶
            const files = ['js/app.js', 'js/utils.js', 'css/pages.css'];
            for (let i = 0; i < files.length; i++) {
                showProgress((i + 1) * 20);
                await sleep(200);
            }

            showProgress(70);
            showResult('æ­£åœ¨åº”ç”¨ä¿®å¤è¡¥ä¸...', 'info');

            // ä¿®å¤1ï¼šæ£€æŸ¥switchPageå‡½æ•°
            const fix1 = `
// ä¿®å¤1ï¼šå¢å¼ºçš„switchPageå‡½æ•°
function switchPage(pageId) {
    console.log('åˆ‡æ¢åˆ°é¡µé¢:', pageId);

    // éšè—æ‰€æœ‰é¡µé¢
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => {
        page.classList.remove('active');
        page.style.display = 'none';
    });

    // æ˜¾ç¤ºç›®æ ‡é¡µé¢
    const target = document.getElementById(pageId);
    if (target) {
        target.classList.add('active');
        target.style.display = 'flex'; // å¼ºåˆ¶ä½¿ç”¨flexå¸ƒå±€
        console.log('é¡µé¢åˆ‡æ¢æˆåŠŸ:', pageId);
        return true;
    } else {
        console.error('é¡µé¢æœªæ‰¾åˆ°:', pageId);
        return false;
    }
}`;

            await sleep(500);
            showProgress(85);

            // ä¿®å¤2ï¼šæ£€æŸ¥CSS
            const fix2 = `
// ä¿®å¤2ï¼šç¡®ä¿CSSæ­£ç¡®
const style = document.createElement('style');
style.textContent = \`
.page { display: none; }
.page.active { display: flex !important; }
#main-page { min-height: 100vh; }
\`;
document.head.appendChild(style);`;

            await sleep(500);
            showProgress(95);

            // ä¿®å¤3ï¼šå¢å¼ºçš„handleRegister
            const fix3 = `
// ä¿®å¤3ï¼šå¢å¼ºçš„æ³¨å†Œå¤„ç†
async function handleRegister() {
    console.log('å¼€å§‹æ³¨å†Œæµç¨‹...');

    if (!this.selectedBranch) {
        Utils.showToast('è¯·é€‰æ‹©åˆ†æ‹¨', 'error');
        return;
    }

    try {
        const result = await userApi.register({
            nickname: this.tempNickname,
            branchId: this.selectedBranch
        });

        if (result.success) {
            this.currentUser = result.data;
            console.log('æ³¨å†ŒæˆåŠŸ:', this.currentUser);
            Utils.showToast('æ³¨å†ŒæˆåŠŸï¼è·å¾—æ–°æ‰‹ç¤¼åŒ…', 'success');

            // å¼ºåˆ¶ç­‰å¾…å¹¶åˆ‡æ¢
            setTimeout(() => {
                console.log('å‡†å¤‡åˆ‡æ¢é¡µé¢...');

                // æ–¹æ³•1ï¼šä½¿ç”¨Utils.switchPage
                if (typeof Utils !== 'undefined' && Utils.switchPage) {
                    Utils.switchPage('main-page');
                }

                // æ–¹æ³•2ï¼šæ‰‹åŠ¨åˆ‡æ¢ï¼ˆå¤‡ç”¨ï¼‰
                const login = document.getElementById('login-page');
                const reg = document.getElementById('register-page');
                const main = document.getElementById('main-page');

                if (login) login.classList.remove('active');
                if (reg) reg.classList.remove('active');
                if (main) {
                    main.classList.add('active');
                    main.style.display = 'flex';
                }

                // åˆå§‹åŒ–ä¸»é¡µé¢
                if (this.initMainPage) {
                    this.initMainPage();
                }

                console.log('é¡µé¢åˆ‡æ¢å®Œæˆ');
            }, 1000);
        } else {
            console.error('æ³¨å†Œå¤±è´¥:', result.message);
            Utils.showToast(result.message || 'æ³¨å†Œå¤±è´¥', 'error');
        }
    } catch (e) {
        console.error('æ³¨å†Œå¼‚å¸¸:', e);
        Utils.showToast('æ³¨å†Œå¼‚å¸¸ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°', 'error');
    }
}`;

            await sleep(800);
            showProgress(100);

            showResult(
                'âœ… ä¿®å¤å®Œæˆï¼\n\n' +
                'å·²ç”Ÿæˆä»¥ä¸‹ä¿®å¤æ–¹æ¡ˆï¼š\n\n' +
                'ã€ä¿®å¤1ã€‘å¢å¼ºçš„é¡µé¢åˆ‡æ¢é€»è¾‘\n' +
                'ã€ä¿®å¤2ã€‘å¼ºåˆ¶CSSæ˜¾ç¤ºè§„åˆ™\n' +
                'ã€ä¿®å¤3ã€‘å¢å¼ºçš„æ³¨å†Œå¤„ç†\n\n' +
                'è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n' +
                '1. æ‰“å¼€åŸç‰ˆ index.html\n' +
                '2. æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°\n' +
                '3. å¤åˆ¶ä¸Šé¢çš„ä¿®å¤ä»£ç \n' +
                '4. ç²˜è´´åˆ°æ§åˆ¶å°å¹¶å›è½¦\n' +
                '5. é‡æ–°æµ‹è¯•æ³¨å†Œæµç¨‹\n\n' +
                'æˆ–è€…ç›´æ¥ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼ˆæ¨èï¼‰',
                'success'
            );

            // æ˜¾ç¤ºä¿®å¤ä»£ç 
            const fixCode = fix1 + '\n\n' + fix2 + '\n\n' + fix3;
            console.log('=== ä¿®å¤ä»£ç  ===');
            console.log(fixCode);
        }

        async function testOriginal() {
            showResult('æ­£åœ¨æµ‹è¯•åŸç‰ˆç¨‹åº...', 'info');
            showProgress(10);

            // æ¨¡æ‹Ÿæµ‹è¯•æ­¥éª¤
            const steps = [
                'æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§...',
                'æ£€æŸ¥CSSåŠ è½½...',
                'æ£€æŸ¥JavaScriptåŠ è½½...',
                'æ£€æŸ¥DOMç»“æ„...',
                'æµ‹è¯•localStorage...',
                'æ¨¡æ‹Ÿæ³¨å†Œæµç¨‹...'
            ];

            for (let i = 0; i < steps.length; i++) {
                await sleep(300);
                showProgress((i + 1) * 15);
                console.log(steps[i]);
            }

            showProgress(100);

            // æ£€æŸ¥ç»“æœ
            const issues = [];

            if (typeof localStorage === 'undefined') {
                issues.push('âŒ æµè§ˆå™¨ä¸æ”¯æŒlocalStorage');
            }

            if (!document.getElementById('main-page')) {
                issues.push('âŒ ä¸»é¡µé¢å…ƒç´ æœªæ‰¾åˆ°');
            }

            if (!document.getElementById('login-page')) {
                issues.push('âŒ ç™»å½•é¡µé¢å…ƒç´ æœªæ‰¾åˆ°');
            }

            if (issues.length === 0) {
                showResult(
                    'âœ… åŸºç¡€æ£€æŸ¥é€šè¿‡\n\n' +
                    'å¯èƒ½çš„é—®é¢˜ï¼š\n' +
                    '1. é¡µé¢åˆ‡æ¢å‡½æ•°æœªæ­£ç¡®è°ƒç”¨\n' +
                    '2. CSSç±»åä¸åŒ¹é…\n' +
                    '3. å¼‚æ­¥æ—¶åºé—®é¢˜\n\n' +
                    'å»ºè®®ï¼šä½¿ç”¨ä¿®å¤å·¥å…·æˆ–æ›¿ä»£æ–¹æ¡ˆ',
                    'info'
                );
            } else {
                showResult(
                    'âŒ å‘ç°é—®é¢˜ï¼š\n\n' +
                    issues.join('\n') +
                    '\n\nå»ºè®®ï¼šä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ simple.html',
                    'error'
                );
            }
        }

        function useAlternative() {
            const html = `
âœ… æ¨èä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼š

ã€æ–¹æ¡ˆ1ï¼šç®€åŒ–ç‰ˆã€‘
ä¼˜ç‚¹ï¼šä»£ç ç®€å•ï¼Œ100%å¯ç”¨
ç¼ºç‚¹ï¼šåŠŸèƒ½è¾ƒå°‘
ä½¿ç”¨ï¼šç›´æ¥æ‰“å¼€ simple.html

ã€æ–¹æ¡ˆ2ï¼šè°ƒè¯•ç‰ˆã€‘
ä¼˜ç‚¹ï¼šå¸¦è¯¦ç»†æ—¥å¿—ï¼Œå¯æŸ¥çœ‹é—®é¢˜
ç¼ºç‚¹ï¼šç•Œé¢æœ‰è°ƒè¯•é¢æ¿
ä½¿ç”¨ï¼šç›´æ¥æ‰“å¼€ debug.html

ã€æ–¹æ¡ˆ3ï¼šè¯Šæ–­å·¥å…·ã€‘
ä¼˜ç‚¹ï¼šå¸®ä½ æ‰¾åˆ°å…·ä½“é—®é¢˜
ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨ä¿®å¤
ä½¿ç”¨ï¼šæ‰“å¼€ diagnose.html

ã€ç«‹å³è¡ŒåŠ¨ã€‘
ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ‰“å¼€ç®€åŒ–ç‰ˆï¼Œç«‹å³å¼€å§‹æ¸¸æˆï¼
            `;

            showResult(html, 'info');

            // æä¾›å¿«é€ŸæŒ‰é’®
            setTimeout(() => {
                if (confirm('æ˜¯å¦ç«‹å³æ‰“å¼€ç®€åŒ–ç‰ˆå¼€å§‹æ¸¸æˆï¼Ÿ')) {
                    window.open('simple.html', '_blank');
                }
            }, 500);
        }

        // é¡µé¢åŠ è½½æ—¶çš„è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            console.log('ğŸ”§ ä¿®å¤å·¥å…·å·²åŠ è½½');
            console.log('è¯·é€‰æ‹©ä¸Šé¢çš„é€‰é¡¹è¿›è¡Œæ“ä½œ');
        });
    </script>
</body>
</html>
